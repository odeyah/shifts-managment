<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×¨×›×ª ×‘×§×©×•×ª ××©××¨×•×ª ××™×©×™×ª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif, 'Arial Hebrew', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .login-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .employee-selector {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .employee-selector h3 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 1.3rem;
        }
        
        .employee-dropdown {
            width: 100%;
            max-width: 300px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1.1rem;
            background: white;
            margin-bottom: 20px;
        }
        
        .employee-dropdown:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }
        
        .manager-login {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .manager-login input {
            padding: 10px 15px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            margin: 0 10px;
        }
        
        .manager-login input::placeholder {
            color: rgba(255,255,255,0.7);
        }
        
        .btn {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,184,148,0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }
        
        .btn-primary:hover {
            box-shadow: 0 10px 20px rgba(79,172,254,0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #00b894, #00a085);
        }
        
        .employee-form {
            display: none;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .employee-form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .form-title::before {
            content: "ğŸ‘¤";
            font-size: 1.2rem;
        }
        
        .deadline-info {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 0.9rem;
        }
        
        .shifts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .shift-option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            user-select: none;
        }
        
        .shift-option:hover {
            border-color: #4facfe;
            transform: translateY(-2px);
        }
        
        .shift-option.selected {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border-color: #ff6b6b;
            transform: scale(1.02);
        }
        
        .shift-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f8f9fa;
        }
        
        .shift-option.disabled:hover {
            transform: none;
            border-color: #e9ecef;
        }
        
        .shift-date {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: #6c757d;
        }
        
        .shift-option.selected .shift-date {
            color: white;
        }
        
        .shift-time {
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .unavailable-badge {
            position: absolute;
            top: -5px;
            left: -5px;
            background: #ff6b6b;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .counter {
            text-align: center;
            font-size: 1rem;
            color: #6c757d;
            margin: 20px 0;
            padding: 15px;
            background: #e9ecef;
            border-radius: 8px;
        }
        
        .counter.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .counter.limit-reached {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .alert-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #99d6ff;
        }
        
        .form-actions {
            text-align: center;
            margin-top: 30px;
        }
        
        .manager-panel {
            display: none;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-top: 25px;
        }
        
        .manager-panel.active {
            display: block;
        }
        
        .requests-list {
            margin-top: 20px;
        }
        
        .request-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-right: 4px solid #4facfe;
        }
        
        .request-employee {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .request-shifts {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .request-shift {
            background: #ffebee;
            color: #c62828;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.85rem;
            border: 1px solid #ffcdd2;
        }
        
        .empty-state {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>×‘×§×©×•×ª ××©××¨×•×ª</h1>
            <p>×‘×—×¨×• ×¢×“ 3 ××©××¨×•×ª ×©××ª× ×œ× ×™×›×•×œ×™× ×œ×¢×‘×•×“</p>
        </div>
        
        <div class="content">
            <!-- Employee Selection -->
            <div class="employee-selector">
                <h3>×‘×—×¨×• ××ª ×”×©× ×©×œ×›×:</h3>
                <select class="employee-dropdown" id="employeeSelect" onchange="showEmployeeForm()">
                    <option value="">-- ×‘×—×¨×• ×¢×•×‘×“ --</option>
                </select>
            </div>
            
            <!-- Manager Login -->
            <div class="manager-login">
                <strong>×›× ×™×¡×ª ×× ×”×œ×™×:</strong>
                <input type="password" id="managerPassword" placeholder="×¡×™×¡××ª ×× ×”×œ">
                <button class="btn btn-primary" onclick="checkManagerAccess()">×›× ×™×¡×”</button>
            </div>
            
            <!-- Deadline Info -->
            <div class="deadline-info" id="deadlineInfo"></div>
            
            <!-- Employee Form -->
            <div class="employee-form" id="employeeForm">
                <div class="form-title" id="formTitle">×‘×—×™×¨×ª ××©××¨×•×ª</div>
                
                <div class="alert alert-info">
                    <strong>×”×•×¨××•×ª:</strong> ×‘×—×¨×• ×¢×“ 3 ××©××¨×•×ª ×©××ª× <strong>×œ× ×™×›×•×œ×™×</strong> ×œ×¢×‘×•×“ ×‘×©×‘×•×¢ ×”×¨×œ×•×•× ×˜×™
                </div>
                
                <div class="shifts-grid" id="shiftsGrid"></div>
                
                <div class="counter" id="shiftsCounter">
                    ××©××¨×•×ª ×œ× ×–××™× ×•×ª: 0/3
                </div>
                
                <div class="form-actions">
                    <button class="btn btn-success" onclick="submitRequest()">×©×œ×™×—×ª ×‘×§×©×”</button>
                    <button class="btn btn-danger" onclick="clearSelections()">××™×¤×•×¡ ×‘×—×™×¨×•×ª</button>
                </div>
            </div>
            
            <!-- Manager Panel -->
            <div class="manager-panel" id="managerPanel">
                <h3>×¤×× ×œ ×× ×”×œ×™×</h3>
                <div class="form-actions">
                    <button class="btn btn-primary" onclick="viewAllRequests()">×¦×¤×™×™×” ×‘×›×œ ×”×‘×§×©×•×ª</button>
                    <button class="btn" onclick="exportAllRequests()">×™×™×¦×•× ×œ×’×•×’×œ ×©×™×˜×¡</button>
                    <button class="btn btn-danger" onclick="clearAllData()">××™×¤×•×¡ ×›×œ ×”× ×ª×•× ×™×</button>
                </div>
                
                <div class="requests-list" id="requestsList"></div>
            </div>
        </div>
    </div>

    <script>
        // ×¨×©×™××ª ×¢×•×‘×“×™× - ×¢×“×›× ×• ×›××Ÿ ××ª ×”×©××•×ª ×©×œ×›×
        const employees = [
            '××‘×™××œ ×©×™×œ×´×ª','××‘×™×’×“ ×©××•××œ','××‘×™×” ×“×¨×•×¨','××‘×™×©×™ ×•×§× ×™×Ÿ','××”×“ ××¨×§','××”×¨×Ÿ ×’×•×¡×˜','××•×“×”-×™-×” ××‘×œ×¡','××•×¤×™×¨ ×©×™×™× ×¤×œ×“',
			'××•×¨×™ ×”×¨××•×¡','××•×¨×™ ×¢×§×‘×™×”','××•×¨×™××œ ×§×™×¨×©','××•×©×¨×ª ×˜×•×•××‘×”','××™×™×œ ×”×›×˜','××™×™×œ×•×Ÿ ×‘×Ÿ ×¢××™','××™×ª×™ ×’×•× ×Ÿ','××™×ª×™ ×’×™×œ×ª',
			'××™×ª××¨ ×“× ×”','××™×ª××¨ ×¡×“×™×§×”','××™×ª××¨ ×¢×¦××•×Ÿ','××œ×” ×”×•×œ× ×“×¨','××œ×™×¢×–×¨ ×§×œ×™×™×Ÿ','××œ×™×¨×Ÿ ×©××©×•×Ÿ','××œ×¢×“ ×¦×‘×¨×™','××¡×£ ×’×œ×¤×¨×™×Ÿ',
			'××¨×™×” ×§× ×¦×™×¤×¨','×‘× ×™××™×Ÿ ×’×¨×•× ×¤×œ×“','×’×‘×¨×™××œ ××’×¡×™','×’×™× ×××™×¨','×’×™× ×‘×¨××Ÿ','×’×œ ×™×’×™×œ','×“×‘×•×¨×” ×¨××§','×“×‘×™×¨ ×›× ×¨×ª×™',
			'×“×‘×™×¨ ×§×¨×Ÿ ×¦×‘×™','×“×•×¨×™ ×’×¨×•×¡××Ÿ','×“× ×™××œ ×”×¨××Ÿ','×•×œ×“×™×¡×œ×‘ ×§×•×©× ×™×‘ ××œ× ×™×¦×¨','×–×™×• ×©××©','×—×’×™ ×©×™×œ×´×ª','×—×Ÿ × ×¤×ª×œ×™','×˜×œ××•×¨ ×›×•×œ×‘',
			'×™××™×¨ × ×‘×˜','×™×”×•× ×ª×Ÿ ×§×œ×™×Ÿ','×™×•××‘ ×’×•×œ×“×”×•×¨×Ÿ','×™×•××‘ ×§×“×¨','×™×•× ×ª×Ÿ ×¨××•×ª','×™×¢×œ ×’×¨×©×‘×¨×’','×™×¢×œ ×•×‘×¨','×™×©×™ ×¨×•×–× ×¦×•×•×™×’','×›×¤×™×¨ ×‘×™×˜×•×Ÿ',
			'×›×¨××œ ××•×¨×œ×™','×œ×•×˜× ××”×¨×•×Ÿ','×œ×™ ×¢×™×“×Ÿ','×œ×™××•×¨ ×××™×¨×•×‘×™×¥','×œ×™×” ×™×¤×¨×—','×œ×™×¨×•×Ÿ ×‘×¨×•×','×œ×™×¨×™ ×§×•×œ××•×¡','×××™ ×¢×•×–','×××™×” × ×”×¨×™',
			'×××™×” ×¡×œ× ×§×™×Ÿ','×××™×” ×§×¨×™×œ','××™×” ×œ×–×•×‘×¡×§×™','××™×” ×¨×•×','××™×§×” ×¤×¨×œ×©×˜×™×Ÿ','××œ××›×™ ×œ×•×˜×•×•×§','×× ×—× ×”×¨×¤× ×¡','××¢×™×™×Ÿ ×˜××©×”','××ª×Ÿ ××‘×™××‘',
			'× ××•×” ×¤×™× ×§×œ××Ÿ','× ×“×‘ ×œ×™×‘× ×”','× ×•×¢× ×’×¨×™×Ÿ','× ×•×¢× ×œ×•×™× ×©×˜×¨×Ÿ','× ×—××™×” ×•×§×©×™','× ×˜×¢ ×•×™××Ÿ','× ×¢× ×ª×’×¨','× ×¢××™×” ×©× ×™',
			'× ×¨×™×” ×›×”×Ÿ','× ×ª× ××œ ×¨×•×‘×™× ×©×˜×™×™×Ÿ','×¡××“×¨ ×œ××•×¤×¨','×¡×¤×™ ××œ×™××©','×¡×ª×™×• ×‘×¨×•× ×™','×¢×“×™ ×”×œ××Ÿ','×¢×“×Ÿ ××©×›× ×–×™','×¢×•××¨ ×›×•×¨×©',
			'×¢×•××¨ ××œ×¨','×¢×•××¨×™ ×©××¢×•×Ÿ ××•×¨','×¢×•×¤×¨×™ ×¨×•×–×Ÿ','×¢×–×¨× ×’×‘××™','×¢×™×“×• ×–×™×’×œ×‘×•×™×','×¢×™×“×• ××™×œ×¨','×¢×™×“×• ×©×œ×•','×¢×™×“×Ÿ ×˜×œ',
			'×¢×™×™× ×” ×œ×™×™×˜×¡×˜×•×Ÿ','×¢×™×œ×™ ×’×œ×–×¨','×¢×™× ×‘ ×”×¨×¥','×¢×œ×™×–×” ×¤×™×œ×™×¤×•×Ÿ','×¢××™××œ ×”×™×¨×©×¤×œ×“','×¢××™×ª ××™×™×–× ×§×•×˜','×¢××™×ª ×›×ª×¨',
			'×¢××™×ª ×¡×™××•×Ÿ','×¢××¨ ××œ×¨','×¢×¤×¨×™ ×¨×’×‘','×¢×§×™×‘×” ×’××•×¡','×§××¨×™×Ÿ ×œ×•×‘×œ×™×Ÿ','×§×™× ×œ×•×™','×§×¨×™× ×” ××¤×§×™×©×‘','×¨××•×‘×Ÿ ×›×”×Ÿ',
			'×¨×•×Ÿ ×”×¨×•×©','×¨×•×Ÿ ×©×œ×•×','×¨×•×¢×™ ××™×–×³×§','×¨×•×¢×™ ×•×™×™×¡','×¨×•×¢×™ ×›×”×Ÿ','×¨×– ×©××©','×¨×Ÿ ××™×“×œ','×¨×¢×•×ª ×œ×•×™','×¨×¢× ×¤×™××˜×§×•×‘×¡×§×™',
			'×¨×¤××œ ×××™×¨×™','×©×’×™× ×›×ª×¨×™','×©×•×Ÿ ××§× ×”','×©×—×¨ ×›×”×Ÿ','×©×™ ×›×¥','×©×™ ×¤×¨×™×“××Ÿ','×©×™×¨ ×’×œ ××•×Ÿ','×©×™×¨ ×™×”×‘','×©×™×¨ ×¡×¨×œ××•×™',
			'×©×™×¨××œ ××œ×“×¨','×©×™×¨×” ××œ×’×‘×™×©','×©×™×¨×” ×™× ×™×¨','×©×œ×•× ××•×¨×™ ×“× ×™× ×•','×©×œ×™ ×¤××¨','×©×§×“ ×™×¨×•×©×œ××™','×ª×”×™×œ×” ×ª××©××¢','×ª×•××¨ ××™×“×Ÿ',
			'×ª×•××¨ ×¨×‘×× ×™','×ª××¨ ××‘× ×™××œ','×ª××¨×” ×”×›×”×Ÿ','×ª× ×™ ×‘× ×“×¨×©','××‘×™×¢×“ ×’×•×˜××Ÿ','××‘×™×¨× ××¨×•×','××•×¤×§ ×œ×•×’×¡×™','××™×ª××¨ ×›×”×Ÿ',
			'××œ×“×“ ×¨×™×§×œ×™×Ÿ','××œ×•×Ÿ ×‘××¨×™','××œ×•×Ÿ ×§×¡×œ','××œ×¢×“ ×¨×¤×•××”','××¨×™×” ×××™×¨','×‘×¨×§ ×›×¥','×‘×¨×§ ×¨×•× ×‘×¨×’','×’×™× ××•×¨ ×œ×‘×Ÿ','×’×™× ×× ×ª×™×Ÿ',
			'×’×™× ×’×–','×’×™× ×”×“×¨×™','×“×•×“ ×‘×¨×“×™×¦×‘×¡×§×™','×˜×œ ×™×¢×§×‘','×˜×œ ×œ×™×‘×•×‘×™×¥','×˜×œ × ×ª×™×‘','×™×”×•× ×ª×Ÿ ×‘×œ×•×','×™×”×•× ×ª×Ÿ ×§×¦×‘','×™×•×’×‘ ××œ××•×’',
			'×™×•× ×ª×Ÿ ×•×•×œ×•×š','×™×•×¡×™ ×—××œ×•','×™×¨×™×Ÿ ×™×¦×—×§','×›×¤×™×¨ ×‘×¨×“×”','×œ×™×××™ × ××× ×™','×××•×¨ ××’×™×‘','××ª×Ÿ ××‘×œ×’×•×Ÿ','× ×™×¨ ×œ×‘× ×•×Ÿ',
			'× ×™×ª××™ ×¨×•×–× ×‘×¨×’','×¡×¤×™×¨ ×‘×˜×•×¨×™','×¢×“×Ÿ ×¡× ×™×•×¨','×¢×•××¨ ×“×¤× ×™','×¢×–×¨× ×’×‘××™','×¢××™×ª ×¤×¨×™','×¢× ×ª ×›×”× ×','×¢×¤×¨×™ ×‘×Ÿ ××‘×™','×¦×•×¨ ×”×™×™× ×™×’',
			'×¨×•×ª× ××—×“×•×ª','×©×—×£ ×©×•×§×¨×•×Ÿ','×©×œ×•××™ ××œ××›×™','×©××—×” ×©××¨×œ×™× ×’','×©××¢×•×Ÿ ××œ×§××• ××‘×‘×”','×©× ×”×‘ × ×“×™×¨','××œ×™ ×©×•×‘','×™×¦×—×§ ×¨×•×“×¨×™×’×–'
        ];
        
        // ×™××™ ×”×©×‘×•×¢ ×‘×¢×‘×¨×™×ª (××ª×—×™×œ ×‘×¨××©×•×Ÿ)
        const hebrewDays = ['×¨××©×•×Ÿ', '×©× ×™', '×©×œ×™×©×™', '×¨×‘×™×¢×™', '×—××™×©×™', '×©×™×©×™', '×©×‘×ª'];
        const shortHebrewDays = ['×\'', '×‘\'', '×’\'', '×“\'', '×”\'', '×•\'', '×©\''];
        
        // ××©×ª× ×™× ×’×œ×•×‘×œ×™×™×
        let currentEmployee = '';
        let selectedShifts = [];
        let currentDeadlineWeek = null;
        let isManager = false;
        const managerPassword = 'manager123'; // ×©× ×• ××ª ×”×¡×™×¡××” ×›××Ÿ
        
        // ××ª×—×•×œ
        document.addEventListener('DOMContentLoaded', function() {
            populateEmployeeDropdown();
            updateDeadlineInfo();
            setInterval(updateDeadlineInfo, 60000); // ×¢×“×›×•×Ÿ ×›×œ ×“×§×”
        });
        
        // ××™×œ×•×™ ×¨×©×™××ª ×¢×•×‘×“×™×
        function populateEmployeeDropdown() {
            const select = document.getElementById('employeeSelect');
            employees.forEach(employee => {
                const option = document.createElement('option');
                option.value = employee;
                option.textContent = employee;
                select.appendChild(option);
            });
        }
        
        // ×”×¦×’×ª ×˜×•×¤×¡ ×¢×•×‘×“
        function showEmployeeForm() {
            const selectedEmployee = document.getElementById('employeeSelect').value;
            
            if (!selectedEmployee) {
                document.getElementById('employeeForm').classList.remove('active');
                return;
            }
            
            currentEmployee = selectedEmployee;
            document.getElementById('formTitle').textContent = `${selectedEmployee} - ×‘×—×™×¨×ª ××©××¨×•×ª`;
            
            // ×˜×¢×™× ×ª ×‘×—×™×¨×•×ª ×©××•×¨×•×ª
            loadEmployeeSelections();
            
            // ×™×¦×™×¨×ª ×’×¨×™×“ ×”××©××¨×•×ª
            generateShiftsGrid();
            
            // ×”×¦×’×ª ×”×˜×•×¤×¡
            document.getElementById('employeeForm').classList.add('active');
        }
        
        // ×™×¦×™×¨×ª ×’×¨×™×“ ×”××©××¨×•×ª
        function generateShiftsGrid() {
            const grid = document.getElementById('shiftsGrid');
            grid.innerHTML = '';
            
            currentDeadlineWeek.forEach((date, dayIndex) => {
                const hebrewDay = shortHebrewDays[dayIndex];
                const dateStr = `${hebrewDay} ${date.getDate()}/${date.getMonth() + 1}`;
                
                // ××©××¨×ª ×™×•×
                const dayId = `${dayIndex}-day`;
                const daySelected = selectedShifts.includes(dayId);
                const dayDisabled = selectedShifts.length >= 3 && !daySelected;
                
                const dayShift = document.createElement('div');
                dayShift.className = `shift-option ${daySelected ? 'selected' : ''} ${dayDisabled ? 'disabled' : ''}`;
                dayShift.onclick = () => toggleShift(dayId);
                dayShift.innerHTML = `
                    <div class="shift-date">${dateStr}</div>
                    <div class="shift-time">×™×•×</div>
                    ${daySelected ? '<div class="unavailable-badge">âœ—</div>' : ''}
                `;
                grid.appendChild(dayShift);
                
                // ××©××¨×ª ×œ×™×œ×”
                const nightId = `${dayIndex}-night`;
                const nightSelected = selectedShifts.includes(nightId);
                const nightDisabled = selectedShifts.length >= 3 && !nightSelected;
                
                const nightShift = document.createElement('div');
                nightShift.className = `shift-option ${nightSelected ? 'selected' : ''} ${nightDisabled ? 'disabled' : ''}`;
                nightShift.onclick = () => toggleShift(nightId);
                nightShift.innerHTML = `
                    <div class="shift-date">${dateStr}</div>
                    <div class="shift-time">×œ×™×œ×”</div>
                    ${nightSelected ? '<div class="unavailable-badge">âœ—</div>' : ''}
                `;
                grid.appendChild(nightShift);
            });
            
            updateCounter();
        }
        
        // ×”×—×œ×¤×ª ×‘×—×™×¨×ª ××©××¨×ª
        function toggleShift(shiftId) {
            const index = selectedShifts.indexOf(shiftId);
            
            if (index > -1) {
                // ×”×¡×¨×ª ×”×‘×—×™×¨×”
                selectedShifts.splice(index, 1);
            } else {
                // ×”×•×¡×¤×ª ×‘×—×™×¨×” ×× ××ª×—×ª ×œ××’×‘×œ×”
                if (selectedShifts.length < 3) {
                    selectedShifts.push(shiftId);
                }
            }
            
            generateShiftsGrid();
        }
        
        // ×¢×“×›×•×Ÿ ××•× ×”
        function updateCounter() {
            const counter = document.getElementById('shiftsCounter');
            const count = selectedShifts.length;
            
            counter.textContent = `××©××¨×•×ª ×œ× ×–××™× ×•×ª: ${count}/3`;
            
            if (count === 3) {
                counter.className = 'counter limit-reached';
                counter.textContent += ' (×”×’×¢×ª× ×œ××’×‘×œ×”)';
            } else if (count === 2) {
                counter.className = 'counter warning';
            } else {
                counter.className = 'counter';
            }
        }
        
        // ×©×œ×™×—×ª ×‘×§×©×”
        function submitRequest() {
            if (!currentEmployee) {
                alert('×× × ×‘×—×¨×• ×©× ×¢×•×‘×“ ×§×•×“×');
                return;
            }
            
            if (selectedShifts.length === 0) {
                if (confirm('×œ× ×‘×—×¨×ª× ××©××¨×•×ª ×œ× ×–××™× ×•×ª. ×”×× ××ª× ×–××™× ×™× ×œ×›×œ ×”××©××¨×•×ª?')) {
                    saveEmployeeRequest();
                    alert('×”×‘×§×©×” × ×©×œ×—×” ×‘×”×¦×œ×—×”! ××ª× ×–××™× ×™× ×œ×›×œ ×”××©××¨×•×ª.');
                }
                return;
            }
            
            saveEmployeeRequest();
            alert(`×”×‘×§×©×” × ×©×œ×—×” ×‘×”×¦×œ×—×”! ×‘×—×¨×ª× ${selectedShifts.length} ××©××¨×•×ª ×©××ª× ×œ× ×–××™× ×™× ××œ×™×”×Ÿ.`);
        }
        
        // ×©××™×¨×ª ×‘×§×©×ª ×¢×•×‘×“
        function saveEmployeeRequest() {
            const weekKey = getWeekKey();
            const allRequests = JSON.parse(localStorage.getItem('employeeRequests') || '{}');
            
            if (!allRequests[weekKey]) {
                allRequests[weekKey] = {};
            }
            
            allRequests[weekKey][currentEmployee] = [...selectedShifts];
            localStorage.setItem('employeeRequests', JSON.stringify(allRequests));
        }
        
        // ×˜×¢×™× ×ª ×‘×—×™×¨×•×ª ×¢×•×‘×“
        function loadEmployeeSelections() {
            const weekKey = getWeekKey();
            const allRequests = JSON.parse(localStorage.getItem('employeeRequests') || '{}');
            
            if (allRequests[weekKey] && allRequests[weekKey][currentEmployee]) {
                selectedShifts = [...allRequests[weekKey][currentEmployee]];
            } else {
                selectedShifts = [];
            }
        }
        
        // ××™×¤×•×¡ ×‘×—×™×¨×•×ª
        function clearSelections() {
            if (confirm('×”×× ××ª× ×‘×˜×•×—×™× ×©××ª× ×¨×•×¦×™× ×œ××¤×¡ ××ª ×”×‘×—×™×¨×•×ª?')) {
                selectedShifts = [];
                generateShiftsGrid();
            }
        }
        
        // ×‘×“×™×§×ª ×’×™×©×ª ×× ×”×œ
        function checkManagerAccess() {
            const password = document.getElementById('managerPassword').value;
            
            if (password === managerPassword) {
                isManager = true;
                document.getElementById('managerPanel').classList.add('active');
                alert('×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×” ×›×× ×”×œ!');
            } else if (password) {
                alert('×¡×™×¡××” ×©×’×•×™×”');
            }
        }
        
        // ×¦×¤×™×™×” ×‘×›×œ ×”×‘×§×©×•×ª (×× ×”×œ×™× ×‘×œ×‘×“)
        function viewAllRequests() {
            if (!isManager) return;
            
            const weekKey = getWeekKey();
            const allRequests = JSON.parse(localStorage.getItem('employeeRequests') || '{}');
            const weekRequests = allRequests[weekKey] || {};
            
            const container = document.getElementById('requestsList');
            container.innerHTML = '<h4>×‘×§×©×•×ª ×¢×•×‘×“×™× ×œ×©×‘×•×¢ ×”×¨×œ×•×•× ×˜×™:</h4>';
            
            if (Object.keys(weekRequests).length === 0) {
                container.innerHTML += '<div class="empty-state">××™×Ÿ ×‘×§×©×•×ª ×¢×•×‘×“×™× ×¢×“×™×™×Ÿ</div>';
                return;
            }
            
            Object.keys(weekRequests).forEach(employee => {
                const shifts = weekRequests[employee];
                const requestDiv = document.createElement('div');
                requestDiv.className = 'request-item';
                
                let shiftsHTML = '';
                if (shifts.length === 0) {
                    shiftsHTML = '<span style="color: green; font-weight: 600;">×–××™×Ÿ ×œ×›×œ ×”××©××¨×•×ª</span>';
                } else {
                    shifts.forEach(shiftId => {
                        const [dayIndex, shiftType] = shiftId.split('-');
                        const hebrewDay = shortHebrewDays[parseInt(dayIndex)];
                        const shiftTypeHe = shiftType === 'day' ? '×™×•×' : '×œ×™×œ×”';
                        
                        shiftsHTML += `<span class="request-shift">${hebrewDay} - ${shiftTypeHe}</span>`;
                    });
                }
                
                requestDiv.innerHTML = `
                    <div class="request-employee">${employee} (${shifts.length}/3 ×‘×§×©×•×ª)</div>
                    <div class="request-shifts">${shiftsHTML}</div>
                `;
                
                container.appendChild(requestDiv);
            });
        }
        
        // ×™×™×¦×•× ×›×œ ×”×‘×§×©×•×ª
        function exportAllRequests() {
            if (!isManager) return;
            
            const weekKey = getWeekKey();
            const allRequests = JSON.parse(localStorage.getItem('employeeRequests') || '{}');
            const weekRequests = allRequests[weekKey] || {};
            
            let csvContent = '×©× ×¢×•×‘×“,';
            
            // ×™×¦×™×¨×ª ×›×•×ª×¨×•×ª
            currentDeadlineWeek.forEach((date, index) => {
                const hebrewDay = shortHebrewDays[index];
                const dateStr = `${hebrewDay} ${date.getDate()}/${date.getMonth() + 1}`;
                csvContent += `${dateStr} ×™×•×,${dateStr} ×œ×™×œ×”,`;
            });
            csvContent = csvContent.slice(0, -1) + '\n';
            
            // ×”×•×¡×¤×ª × ×ª×•× ×™ ×¢×•×‘×“×™×
            employees.forEach(employee => {
                const employeeShifts = weekRequests[employee] || [];
                csvContent += `${employee},`;
                
                currentDeadlineWeek.forEach((date, dayIndex) => {
                    const dayId = `${dayIndex}-day`;
                    const nightId = `${dayIndex}-night`;
                    
                    const dayStatus = employeeShifts.includes(dayId) ? '×œ× ×–××™×Ÿ' : '×–××™×Ÿ';
                    const nightStatus = employeeShifts.includes(nightId) ? '×œ× ×–××™×Ÿ' : '×–××™×Ÿ';
                    
                    csvContent += `${dayStatus},${nightStatus},`;
                });
                
                csvContent = csvContent.slice(0, -1) + '\n';
            });
            
            // ×”×¢×ª×§×” ×œ×œ×•×—
            navigator.clipboard.writeText(csvContent).then(() => {
                alert('×”× ×ª×•× ×™× ×”×•×¢×ª×§×• ×œ×œ×•×—! ×ª×•×›×œ×• ×›×¢×ª ×œ×”×“×‘×™×§ ××•×ª× ×‘×’×•×’×œ ×©×™×˜×¡.');
            }).catch(() => {
                console.log('× ×ª×•× ×™ ×”×™×™×¦×•×:', csvContent);
                alert('×”× ×ª×•× ×™× ××•×›× ×™× ×œ×™×™×¦×•× - ×‘×“×§×• ××ª ×”×§×•× ×¡×•×œ');
            });
        }
        
        // ××™×¤×•×¡ ×›×œ ×”× ×ª×•× ×™×
        function clearAllData() {
            if (!isManager) return;
            
            if (confirm('×”×× ××ª× ×‘×˜×•×—×™× ×©××ª× ×¨×•×¦×™× ×œ××¤×¡ ××ª ×›×œ ×”× ×ª×•× ×™×? ×¤×¢×•×œ×” ×–×• ×‘×œ×ª×™ ×”×¤×™×›×”!')) {
                localStorage.removeItem('employeeRequests');
                alert('×›×œ ×”× ×ª×•× ×™× × ××—×§×• ×‘×”×¦×œ×—×”!');
                document.getElementById('requestsList').innerHTML = '';
            }
        }
        
        // ×—×™×©×•×‘ ××•×¢×“ ××—×¨×•×Ÿ ×•×”×©×‘×•×¢ ×”×¨×œ×•×•× ×˜×™
        function updateDeadlineInfo() {
            const now = new Date();
            const currentDay = now.getDay(); // 0 = ×¨××©×•×Ÿ, 1 = ×©× ×™, ×•×›×•'
            const currentHour = now.getHours();
            
            // ×‘×“×™×§×” ×× ×¢×‘×¨× ×• ××ª ×”××•×¢×“ ××—×¨×•×Ÿ (×¨×‘×™×¢×™ 10:00)
            const passedDeadline = (currentDay > 3) || (currentDay === 3 && currentHour >= 10);
            
            let targetWeek;
            let deadlineDate;
            
            if (passedDeadline) {
                // ×× ×¢×‘×¨ ×”××•×¢×“ ××—×¨×•×Ÿ, ×”×‘×§×©×•×ª ×”×Ÿ ×¢×‘×•×¨ ×”×©×‘×•×¢ ×©××—×¨×™ ×”×‘×
                targetWeek = getWeekAfterNext();
                deadlineDate = getNextWednesday();
            } else {
                // ×× ×œ× ×¢×‘×¨ ×”××•×¢×“ ××—×¨×•×Ÿ, ×”×‘×§×©×•×ª ×”×Ÿ ×¢×‘×•×¨ ×”×©×‘×•×¢ ×”×‘×
                targetWeek = getNextWeekDates();
                deadlineDate = getThisWednesday();
            }
            
            currentDeadlineWeek = targetWeek;
            
            // ×¢×“×›×•×Ÿ ××™×“×¢ ××•×¢×“ ××—×¨×•×Ÿ
            const timeLeft = deadlineDate.getTime() - now.getTime();
            const daysLeft = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
            const hoursLeft = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            
            let deadlineText = '';
            if (timeLeft > 0) {
                const weekType = passedDeadline ? '×”×©×‘×•×¢ ×©××—×¨×™ ×”×‘×' : '×”×©×‘×•×¢ ×”×‘×';
                deadlineText = `â° ×‘×§×©×•×ª ×¢×‘×•×¨ ${weekType} | ××•×¢×“ ××—×¨×•×Ÿ: ${deadlineDate.toLocaleDateString('he-IL')} ×‘×©×¢×” 10:00 (× ×•×ª×¨×• ${daysLeft} ×™××™× ×•-${hoursLeft} ×©×¢×•×ª)`;
            } else {
                deadlineText = `â° ×”××•×¢×“ ××—×¨×•×Ÿ ×¢×‘×¨ - ×‘×§×©×•×ª ×—×“×©×•×ª ×”×Ÿ ×¢×‘×•×¨ ×”×©×‘×•×¢ ×©××—×¨×™ ×”×‘×`;
            }
            
            document.getElementById('deadlineInfo').innerHTML = deadlineText;
            
            // ×¢×“×›×•×Ÿ ×’×¨×™×“ ×× ×™×© ×¢×•×‘×“ × ×‘×—×¨
            if (currentEmployee) {
                generateShiftsGrid();
            }
        }
        
        // ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×œ×ª××¨×™×›×™×
        function getNextWeekDates() {
            const today = new Date();
            const nextSunday = new Date(today);
            nextSunday.setDate(today.getDate() + (7 - today.getDay()));
            
            const dates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(nextSunday);
                date.setDate(nextSunday.getDate() + i);
                dates.push(date);
            }
            return dates;
        }
        
        function getWeekAfterNext() {
            const today = new Date();
            const weekAfterNextSunday = new Date(today);
            weekAfterNextSunday.setDate(today.getDate() + (14 - today.getDay()));
            
            const dates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(weekAfterNextSunday);
                date.setDate(weekAfterNextSunday.getDate() + i);
                dates.push(date);
            }
            return dates;
        }
        
        function getThisWednesday() {
            const today = new Date();
            const wednesday = new Date(today);
            const daysUntilWednesday = (3 - today.getDay() + 7) % 7;
            wednesday.setDate(today.getDate() + daysUntilWednesday);
            wednesday.setHours(10, 0, 0, 0);
            return wednesday;
        }
        
        function getNextWednesday() {
            const thisWednesday = getThisWednesday();
            const nextWednesday = new Date(thisWednesday);
            nextWednesday.setDate(thisWednesday.getDate() + 7);
            return nextWednesday;
        }
        
        function getWeekKey() {
            if (!currentDeadlineWeek || currentDeadlineWeek.length === 0) return 'current';
            const firstDate = currentDeadlineWeek[0];
            return `${firstDate.getFullYear()}-${firstDate.getMonth()}-${firstDate.getDate()}`;
        }
    </script>
</body>
</html>