<html lang="he" dir="rtl">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>מערכת בקשות משמרות</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				min-height: 100vh;
				padding: 20px;
				direction: rtl;
			}

			.container {
				max-width: 800px;
				margin: 0 auto;
				background: white;
				border-radius: 15px;
				box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
				overflow: hidden;
			}

			.header {
				background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
				color: white;
				padding: 30px;
				text-align: center;
			}

			.header h1 {
				font-size: 2.5rem;
				margin-bottom: 10px;
				font-weight: 300;
			}

			.header p {
				font-size: 1.1rem;
				opacity: 0.9;
			}

			.content {
				padding: 30px;
			}

			.employee-selector {
				background: #f8f9fa;
				border-radius: 12px;
				padding: 25px;
				margin-bottom: 25px;
				text-align: center;
			}

			.employee-selector h3 {
				margin-bottom: 20px;
				color: #2c3e50;
				font-size: 1.3rem;
			}

			.employee-dropdown {
				width: 100%;
				max-width: 300px;
				padding: 15px;
				border: 2px solid #e9ecef;
				border-radius: 10px;
				font-size: 1.1rem;
				background: white;
				margin-bottom: 20px;
				transition: all 0.3s ease;
			}

			.employee-dropdown:focus {
				outline: none;
				border-color: #4facfe;
				box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
			}

			.btn {
				background: linear-gradient(135deg, #00b894, #00a085);
				color: white;
				border: none;
				padding: 15px 30px;
				border-radius: 10px;
				font-size: 1.1rem;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s ease;
				margin: 10px;
			}

			.btn:hover {
				transform: translateY(-2px);
				box-shadow: 0 10px 20px rgba(0, 184, 148, 0.3);
			}

			.btn:disabled {
				opacity: 0.6;
				cursor: not-allowed;
				transform: none;
			}

			.btn-danger {
				background: linear-gradient(135deg, #ff6b6b, #ee5a52);
			}

			.btn-success {
				background: linear-gradient(135deg, #00b894, #00a085);
			}

			.employee-form {
				background: #f8f9fa;
				border-radius: 12px;
				padding: 25px;
				margin-bottom: 25px;
				display: none;
				opacity: 0;
				transform: translateY(20px);
				transition: all 0.5s ease;
			}

			.employee-form.show {
				display: block;
				opacity: 1;
				transform: translateY(0);
			}

			.form-title {
				font-size: 1.4rem;
				font-weight: 600;
				color: #2c3e50;
				margin-bottom: 20px;
				text-align: center;
			}

			.deadline-info {
				background: linear-gradient(135deg, #74b9ff, #0984e3);
				color: white;
				padding: 15px;
				border-radius: 10px;
				margin-bottom: 20px;
				text-align: center;
				font-size: 0.9rem;
			}

			.shifts-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
				gap: 15px;
				margin-bottom: 20px;
			}

			.shift-option {
				background: white;
				border: 2px solid #e9ecef;
				border-radius: 10px;
				padding: 15px;
				cursor: pointer;
				transition: all 0.3s ease;
				text-align: center;
				position: relative;
				user-select: none;
			}

			.shift-option:hover:not(.disabled) {
				border-color: #4facfe;
				transform: translateY(-2px);
			}

			.shift-option.selected {
				background: linear-gradient(135deg, #ff6b6b, #ee5a52);
				color: white;
				border-color: #ff6b6b;
				transform: scale(1.02);
			}

			.shift-option.disabled {
				opacity: 0.5;
				cursor: not-allowed;
				background: #f8f9fa;
			}

			.shift-date {
				font-weight: 600;
				font-size: 0.9rem;
				margin-bottom: 5px;
				color: #6c757d;
			}

			.shift-option.selected .shift-date {
				color: white;
			}

			.shift-time {
				font-size: 1.1rem;
				font-weight: 500;
			}

			.unavailable-badge {
				position: absolute;
				top: -5px;
				left: -5px;
				background: #ff6b6b;
				color: white;
				border-radius: 50%;
				width: 20px;
				height: 20px;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 12px;
				font-weight: bold;
			}

			.counter {
				text-align: center;
				font-size: 1rem;
				color: #6c757d;
				margin: 20px 0;
				padding: 15px;
				background: #e9ecef;
				border-radius: 8px;
				transition: all 0.3s ease;
			}

			.counter.warning {
				background: #fff3cd;
				color: #856404;
				border: 1px solid #ffeaa7;
			}

			.counter.limit-reached {
				background: #f8d7da;
				color: #721c24;
				border: 1px solid #f5c6cb;
			}

			.alert {
				padding: 15px;
				border-radius: 10px;
				margin: 15px 0;
			}

			.alert-info {
				background: #cce7ff;
				color: #004085;
				border: 1px solid #99d6ff;
			}

			.form-actions {
				text-align: center;
				margin-top: 30px;
			}

			.loading {
				display: inline-block;
				width: 20px;
				height: 20px;
				border: 3px solid #f3f3f3;
				border-top: 3px solid #4facfe;
				border-radius: 50%;
				animation: spin 1s linear infinite;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<h1>בקשות משמרות</h1>
				<p>בחרו עד 3 משמרות שאתם לא יכולים להשתבץ בהם</p>
			</div>

			<div class="content">
				<!-- Employee Selection -->
				<div class="employee-selector">
					<h3>בחרו את השם שלכם:</h3>
					<select id="employeeSelect" class="employee-dropdown">
						<option value="">-- בחרו שם --</option>
						<option value="Employee1">יוסי כהן</option>
						<option value="Employee2">רחל לוי</option>
						<option value="Employee3">משה אברהם</option>
						<option value="Employee4">שרה דוד</option>
						<option value="Employee5">דני מלכה</option>
						<option value="Employee6">מירי רוזן</option>
						<option value="Employee7">אבי שמש</option>
						<option value="Employee8">טלי ברון</option>
						<option value="Employee9">נתן גולד</option>
						<option value="Employee10">מיכל ברק</option>
						<option value="Employee11">רון שחר</option>
						<option value="Employee12">תמר נוי</option>
					</select>
					<select id="shiftsSelect" class="employee-dropdown">
						<option value="">-- בחרו כמות משמרות --</option>
						<option value="1">1</option>
						<option value="2">2</option>
						<option value="צו פתוח">צו פתוח</option>
					</select>
				</div>

				<!-- Deadline Info -->
				<div class="deadline-info" id="deadlineInfo">טוען מידע על מועדים...</div>

				<!-- Employee Form -->
				<div id="employeeForm" class="employee-form">
					<div class="form-title">👤 <span id="employeeName">שם עובד</span> - בחירת משמרות</div>

					<div class="alert alert-info">
						<strong>הוראות:</strong> בחרו עד 3 משמרות שאתם <strong>לא יכולים</strong> לעבוד בשבוע הרלוונטי
					</div>

					<div class="shifts-grid" id="shiftsGrid">
						<!-- Shifts will be populated by JavaScript -->
					</div>

					<div class="counter" id="counter">משמרות לא זמינות: 0/3</div>

					<div class="form-actions">
						<button class="btn btn-success" id="submitBtn">שליחת בקשה</button>
						<button class="btn btn-danger" id="clearBtn">איפוס בחירות</button>
					</div>
				</div>
			</div>
		</div>

		<script>
			// Employee name mapping
			const employeeNames = {
				Employee1: 'יוסי כהן',
				Employee2: 'רחל לוי',
				Employee3: 'משה אברהם',
				Employee4: 'שרה דוד',
				Employee5: 'דני מלכה',
				Employee6: 'מירי רוזן',
				Employee7: 'אבי שמש',
				Employee8: 'טלי ברון',
				Employee9: 'נתן גולד',
				Employee10: 'מיכל ברק',
				Employee11: 'רון שחר',
				Employee12: 'תמר נוי',
			};

			// Application state
			let selectedEmployee = '';
			let selectedShifts = [];
			let currentDeadlineWeek = [];
			let loading = false;

			const shortHebrewDays = ["א'", "ב'", "ג'", "ד'", "ה'", "ו'", "ש'"];

			// DOM elements
			const employeeSelect = document.getElementById('employeeSelect');
			const shiftsSelect = document.getElementById('shiftsSelect');
			const employeeForm = document.getElementById('employeeForm');
			const employeeName = document.getElementById('employeeName');
			const shiftsGrid = document.getElementById('shiftsGrid');
			const counter = document.getElementById('counter');
			const submitBtn = document.getElementById('submitBtn');
			const clearBtn = document.getElementById('clearBtn');
			const deadlineInfo = document.getElementById('deadlineInfo');
			const instructionsContent = document.getElementById('instructionsContent');

			// Initialize application
			function init() {
				updateDeadlineInfo();
				setInterval(updateDeadlineInfo, 60000);
				attachEventListeners();
			}

			// Attach event listeners
			function attachEventListeners() {
				employeeSelect.addEventListener('change', handleEmployeeChange);
				submitBtn.addEventListener('click', submitRequest);
				clearBtn.addEventListener('click', clearSelections);
			}

			// Handle employee selection change
			function handleEmployeeChange() {
				selectedEmployee = employeeSelect.value;
				const displayName = employeeNames[selectedEmployee] || selectedEmployee;
				employeeName.textContent = displayName;

				if (selectedEmployee) {
					loadEmployeeData();
					updateInstructions(); // Update instructions when employee is selected
					employeeForm.classList.add('show');
					generateShiftsGrid();
				} else {
					employeeForm.classList.remove('show');
					selectedShifts = [];
				}
			}

			// Load saved employee data
			function loadEmployeeData() {
				try {
					const savedData = JSON.parse(localStorage.getItem('employeeRequests') || '{}');
					const weekKey = getWeekKey();
					const weekData = savedData[weekKey] || {};
					const displayName = employeeNames[selectedEmployee] || selectedEmployee;
					selectedShifts = weekData[displayName] || [];
					updateCounter();
				} catch (error) {
					console.error('Error loading employee data:', error);
					selectedShifts = [];
				}
			}

			// Generate shifts grid
			function generateShiftsGrid() {
				shiftsGrid.innerHTML = '';

				currentDeadlineWeek.forEach((date, dayIndex) => {
					const hebrewDay = shortHebrewDays[dayIndex];
					const dateStr = `${hebrewDay} ${date.getDate()}/${date.getMonth() + 1}`;

					// Day shift
					const dayShift = createShiftElement(`${dayIndex}-day`, dateStr, 'יום');
					shiftsGrid.appendChild(dayShift);

					// Night shift
					const nightShift = createShiftElement(`${dayIndex}-night`, dateStr, 'לילה');
					shiftsGrid.appendChild(nightShift);
				});
			}

			// Create shift element
			function createShiftElement(shiftId, dateStr, shiftType) {
				const shiftDiv = document.createElement('div');
				shiftDiv.className = 'shift-option';
				shiftDiv.dataset.shiftId = shiftId;

				const isSelected = selectedShifts.includes(shiftId);
				const selectedNoOfShifts = document.getElementById('shiftsSelect').value;

				let maxShifts = 3; // default for "צו פתוח"
				if (selectedNoOfShifts === '1') {
					maxShifts = 1;
				} else if (selectedNoOfShifts === '2') {
					maxShifts = 2;
				}

				const isDisabled =
					(selectedShifts.length >= maxShifts && !isSelected) ||
					(!isSelected && !isShiftSelectionValid(shiftId, selectedShifts));

				if (isSelected) shiftDiv.classList.add('selected');
				if (isDisabled) shiftDiv.classList.add('disabled');

				shiftDiv.innerHTML = `
                <div class="shift-date">${dateStr}</div>
                <div class="shift-time">${shiftType}</div>
                ${isSelected ? '<div class="unavailable-badge">✗</div>' : ''}
            `;

				shiftDiv.addEventListener('click', () => toggleShift(shiftId));

				return shiftDiv;
			}

			// Check if shift selection is valid based on work rules
			function isShiftSelectionValid(shiftId, currentSelections) {
				const [dayIndex, shiftType] = shiftId.split('-');
				const dayNum = parseInt(dayIndex);

				// If no shifts selected yet, any shift is valid
				if (currentSelections.length === 0) {
					return true;
				}

				// Get selected number of shifts from dropdown
				const selectedNoOfShifts = document.getElementById('shiftsSelect').value;

				// If they selected "צו פתוח" (open order), normal 3-shift limit applies
				if (selectedNoOfShifts === 'צו פתוח') {
					return true;
				}

				// For 1 or 2 shifts, apply work rules
				if (selectedNoOfShifts === '1' || selectedNoOfShifts === '2') {
					// Check each currently selected shift
					for (let selectedShift of currentSelections) {
						const [selectedDayIndex, selectedShiftType] = selectedShift.split('-');
						const selectedDayNum = parseInt(selectedDayIndex);

						// Rule 1: Can't work day shift after night shift (24-hour rule)
						if (selectedShiftType === 'night' && shiftType === 'day') {
							// Check if trying to select day shift on the same day as night shift
							if (selectedDayNum === dayNum) {
								return false;
							}
							// Check if trying to select day shift on the day after night shift
							if ((selectedDayNum + 1) % 7 === dayNum) {
								return false;
							}
						}

						// Rule 2: Can't work night shift before day shift (24-hour rule)
						if (selectedShiftType === 'day' && shiftType === 'night') {
							// Check if trying to select night shift on the same day as day shift
							if (selectedDayNum === dayNum) {
								return false;
							}
							// Check if trying to select night shift on the day before day shift
							if ((dayNum + 1) % 7 === selectedDayNum) {
								return false;
							}
						}

						// Rule 3: Night shifts MUST be consecutive
						if (selectedShiftType === 'night' && shiftType === 'night') {
							// Check if consecutive nights (this is REQUIRED)
							const isConsecutive =
								Math.abs(selectedDayNum - dayNum) === 1 ||
								(selectedDayNum === 6 && dayNum === 0) ||
								(selectedDayNum === 0 && dayNum === 6);

							if (!isConsecutive) {
								return false; // Must be consecutive
							}
						}
					}

					// If we're trying to select a second shift and already have one, check the limit
					if (selectedNoOfShifts === '1' && currentSelections.length >= 1) {
						return false;
					}
					if (selectedNoOfShifts === '2' && currentSelections.length >= 2) {
						return false;
					}
				}

				return true;
			}
			function toggleShift(shiftId) {
				const selectedNoOfShifts = document.getElementById('shiftsSelect').value;

				let maxShifts = 3; // Default
				if (selectedNoOfShifts === '1') {
					maxShifts = 1;
				} else if (selectedNoOfShifts === '2') {
					maxShifts = 2;
				}

				const index = selectedShifts.indexOf(shiftId);

				if (index > -1) {
					// Deselect
					selectedShifts.splice(index, 1);
				} else {
					// Only allow new selection if under limit and valid
					if (selectedShifts.length < maxShifts && isShiftSelectionValid(shiftId, selectedShifts)) {
						selectedShifts.push(shiftId);
					}
				}

				generateShiftsGrid();
				updateCounter();
			}

			// Update instructions text based on selected shifts
			function updateInstructions() {
				const selectedNoOfShifts = document.getElementById('shiftsSelect').value;

				if (selectedNoOfShifts === '1') {
					instructionsContent.textContent = 'בחר בבקשה את המשמרת הרצויה';
				} else if (selectedNoOfShifts === '2') {
					instructionsContent.textContent = 'בחר בבקשה את 2 המשמרות שברצונך לעשות';
				} else if (selectedNoOfShifts === 'צו פתוח') {
					instructionsContent.textContent = 'בחר עד 3 משמרות שאת/ה לא יכולים להשתבץ בהם';
				} else {
					instructionsContent.textContent = 'בחרו עד 3 משמרות שאתם לא יכולים להשתבץ בהם';
				}
			}
			function updateCounter() {
				const count = selectedShifts.length;
				const selectedNoOfShifts = document.getElementById('shiftsSelect').value;

				let maxShifts = 3; // default for "צו פתוח"
				let counterText = `משמרות לא זמינות: ${count}/3`;

				if (selectedNoOfShifts === '1') {
					maxShifts = 1;
					counterText = `משמרות לא זמינות: ${count}/1`;
				} else if (selectedNoOfShifts === '2') {
					maxShifts = 2;
					counterText = `משמרות לא זמינות: ${count}/2`;
				}

				counter.textContent = counterText;

				counter.className = 'counter';
				if (count === maxShifts - 1 && maxShifts > 1) counter.classList.add('warning');
				if (count === maxShifts) {
					counter.classList.add('limit-reached');
					counter.textContent += ' (הגעתם למגבלה)';
				}
			}

			// Validate shift selection based on rules
			function validateShiftSelection(numOfShifts, chosenShifts) {
				// Check if "צו פתוח" (Open Order)
				if (numOfShifts === 'צו פתוח') {
					if (chosenShifts.length > 3) {
						return { valid: false, message: `בחרתם ${chosenShifts.length} משמרות אך המקסימום הוא 3 משמרות` };
					}
					return { valid: true };
				}

				// Check if chose "1" shift
				if (numOfShifts === '1') {
					if (chosenShifts.length !== 1) {
						return { valid: false, message: `בחרתם ${chosenShifts.length} משמרות אך צריך לבחור בדיוק 1 משמרת` };
					}
					return { valid: true };
				}

				// Check if chose "2" shifts
				if (numOfShifts === '2') {
					if (chosenShifts.length !== 2) {
						return { valid: false, message: `בחרתם ${chosenShifts.length} משמרות אך צריך לבחור בדיוק 2 משמרות` };
					}

					// Parse the shifts
					const shifts = chosenShifts.map(shiftId => {
						const [dayIndex, shiftType] = shiftId.split('-');
						return {
							dayNum: parseInt(dayIndex),
							shiftType: shiftType,
							dayName: ['ראשון', 'שני', 'שלישי', 'רביעי', 'חמישי', 'שישי', 'שבת'][parseInt(dayIndex)],
						};
					});

					const nightShifts = shifts.filter(s => s.shiftType === 'night');
					const dayShifts = shifts.filter(s => s.shiftType === 'day');

					// Check for consecutive day and night (24-hour rule)
					for (let nightShift of nightShifts) {
						for (let dayShift of dayShifts) {
							// Same day - day and night
							if (nightShift.dayNum === dayShift.dayNum) {
								return {
									valid: false,
									message: `לא ניתן לעבוד יום ולילה באותו יום (${nightShift.dayName}) - עבודה של 24 שעות אסורה`,
								};
							}

							// Day after night
							if ((nightShift.dayNum + 1) % 7 === dayShift.dayNum) {
								return {
									valid: false,
									message: `לא ניתן לעבוד יום ביום ${dayShift.dayName} אחרי לילה ביום ${nightShift.dayName} - עבודה של 24 שעות אסורה`,
								};
							}

							// Night before day
							if ((dayShift.dayNum + 1) % 7 === nightShift.dayNum) {
								return {
									valid: false,
									message: `לא ניתן לעבוד לילה ביום ${nightShift.dayName} לפני יום ביום ${dayShift.dayName} - עבודה של 24 שעות אסורה`,
								};
							}
						}
					}

					// Check for non-consecutive nights
					if (nightShifts.length === 2) {
						const night1 = nightShifts[0];
						const night2 = nightShifts[1];

						// Check if consecutive
						const isConsecutive =
							Math.abs(night1.dayNum - night2.dayNum) === 1 ||
							(night1.dayNum === 6 && night2.dayNum === 0) ||
							(night1.dayNum === 0 && night2.dayNum === 6);

						if (!isConsecutive) {
							return {
								valid: false,
								message: `משמרות לילה חייבות להיות רצופות. בחרתם לילה ביום ${night1.dayName} ולילה ביום ${night2.dayName} - אלו לא רצופות`,
							};
						}
					}

					return { valid: true };
				}

				// If numOfShifts is not recognized
				return { valid: false, message: 'אנא בחרו כמות משמרות מהרשימה הנפתחת' };
			}
			async function submitRequest() {
				if (!selectedEmployee) {
					alert('אנא בחרו שם קודם');
					return;
				}

				const selectedNoOfShifts = document.getElementById('shiftsSelect').value;

				// Run validation BEFORE submitting
				const validation = validateShiftSelection(selectedNoOfShifts, selectedShifts);
				if (!validation.valid) {
					alert(validation.message);
					return;
				}

				setLoading(true);

				try {
					await new Promise(resolve => setTimeout(resolve, 1000));

					if (selectedShifts.length === 0) {
						const confirmed = confirm('לא בחרתם משמרות לא זמינות. האם אתם זמינים לכל המשמרות?');
						if (!confirmed) {
							setLoading(false);
							return;
						}
					}

					saveEmployeeRequest();

					const message =
						selectedShifts.length === 0
							? 'הבקשה נשלחה בהצלחה! אתם זמינים לכל המשמרות.'
							: `הבקשה נשלחה בהצלחה! בחרתם ${selectedShifts.length} משמרות שאתם לא זמינים אליהן.`;

					alert(message);
				} finally {
					setLoading(false);
				}
			}

			// Save employee request
			function saveEmployeeRequest() {
				try {
					const allRequests = JSON.parse(localStorage.getItem('employeeRequests') || '{}');
					const weekKey = getWeekKey();
					const displayName = employeeNames[selectedEmployee] || selectedEmployee;

					if (!allRequests[weekKey]) {
						allRequests[weekKey] = {};
					}

					allRequests[weekKey][displayName] = [...selectedShifts];
					localStorage.setItem('employeeRequests', JSON.stringify(allRequests));
				} catch (error) {
					console.error('Error saving employee request:', error);
					alert('שגיאה בשמירת הבקשה');
				}
			}

			// Clear selections
			function clearSelections() {
				if (confirm('האם אתם בטוחים שאתם רוצים לאפס את הבחירות?')) {
					selectedShifts = [];
					generateShiftsGrid();
					updateCounter();
				}
			}

			// Set loading state
			function setLoading(state) {
				loading = state;
				submitBtn.disabled = state;
				clearBtn.disabled = state || selectedShifts.length === 0;

				if (state) {
					submitBtn.innerHTML = '<span class="loading"></span> שולח...';
				} else {
					submitBtn.innerHTML = 'שליחת בקשה';
				}
			}

			// Date utilities
			function updateDeadlineInfo() {
				try {
					const now = new Date();
					const currentDay = now.getDay();
					const currentHour = now.getHours();

					const passedDeadline = currentDay > 3 || (currentDay === 3 && currentHour >= 10);

					let targetWeek;
					let deadlineDate;

					if (passedDeadline) {
						targetWeek = getWeekAfterNext();
						deadlineDate = getNextWednesday();
					} else {
						targetWeek = getNextWeekDates();
						deadlineDate = getThisWednesday();
					}

					currentDeadlineWeek = targetWeek;

					const timeLeft = deadlineDate.getTime() - now.getTime();
					const daysLeft = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
					const hoursLeft = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));

					if (timeLeft > 0) {
						const weekType = passedDeadline ? 'השבוע שאחרי הבא' : 'השבוע הבא';
						deadlineInfo.textContent = `⏰ בקשות עבור ${weekType} | מועד אחרון: ${deadlineDate.toLocaleDateString(
							'he-IL',
						)} בשעה 10:00 (נותרו ${daysLeft} ימים ו-${hoursLeft} שעות)`;
					} else {
						deadlineInfo.textContent = `⏰ המועד אחרון עבר - בקשות חדשות הן עבור השבוع שאחרי הבא`;
					}

					if (selectedEmployee) {
						generateShiftsGrid();
					}
				} catch (error) {
					console.error('Error updating deadline info:', error);
					deadlineInfo.textContent = 'טוען מידע על מועדים...';
				}
			}

			function getNextWeekDates() {
				const today = new Date();
				const nextSunday = new Date(today);
				nextSunday.setDate(today.getDate() + (7 - today.getDay()));

				const dates = [];
				for (let i = 0; i < 7; i++) {
					const date = new Date(nextSunday);
					date.setDate(nextSunday.getDate() + i);
					dates.push(date);
				}
				return dates;
			}

			function getWeekAfterNext() {
				const today = new Date();
				const weekAfterNextSunday = new Date(today);
				weekAfterNextSunday.setDate(today.getDate() + (14 - today.getDay()));

				const dates = [];
				for (let i = 0; i < 7; i++) {
					const date = new Date(weekAfterNextSunday);
					date.setDate(weekAfterNextSunday.getDate() + i);
					dates.push(date);
				}
				return dates;
			}

			function getThisWednesday() {
				const today = new Date();
				const wednesday = new Date(today);
				const daysUntilWednesday = (3 - today.getDay() + 7) % 7;
				wednesday.setDate(today.getDate() + daysUntilWednesday);
				wednesday.setHours(10, 0, 0, 0);
				return wednesday;
			}

			function getNextWednesday() {
				const thisWednesday = getThisWednesday();
				const nextWednesday = new Date(thisWednesday);
				nextWednesday.setDate(thisWednesday.getDate() + 7);
				return nextWednesday;
			}

			function getWeekKey() {
				if (!currentDeadlineWeek || currentDeadlineWeek.length === 0) return 'current';
				const firstDate = currentDeadlineWeek[0];
				return `${firstDate.getFullYear()}-${firstDate.getMonth()}-${firstDate.getDate()}`;
			}

			// Initialize when page loads
			window.addEventListener('load', init);
		</script>
	</body>
</html>
